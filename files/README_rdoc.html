<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>README.rdoc</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
    <script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            README.rdoc
        </h1>
        <ul class="files">
            <li>README.rdoc</li>
            <li>Last modified: Thu Apr 15 16:16:42 -0700 2010</li>
        </ul>
    </div>

    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <h1>The RPM Contrib Gem</h1>
<p>
The <tt>rpm_contrib</tt> gem contains instrumentation for the New Relic RPM
agent contributed by the community of RPM users. It requires the RPM Agent
to run.
</p>
<p>
To use the contrib gem, install the <tt>rpm_contrib</tt> gem from
gemcutter. It will also install the required version of the
<tt>newrelic_rpm</tt> gem if it&#8217;s not already installed.
</p>
<p>
For Rails 2.1 and later, add this dependency to your in your
environment.rb:
</p>
<pre>
    config.gem 'rpm_contrib'
</pre>
<p>
For other frameworks, make sure you load rubygems if it isn&#8217;t
already, then just require the contrib gem:
</p>
<pre>
    require 'rubygems'
    require 'rpm_contrib'
</pre>
<p>
When you load the rpm_contrib gem, the <tt>newrelic_rpm</tt> gem will also
be initialized. No need for a separate require statement for
<tt>newrelic_rpm</tt>. The <tt>rpm_contrib</tt> gem must be loaded before
the <tt>newrelic_rpm</tt> gem initializes.
</p>
<h1>Supported Frameworks</h1>
<p>
A number of frameworks are supported in the contrib gem. They are all
turned on by default but you can add settings to your newrelic.yml to
disable any of them.
</p>
<h3>Camping</h3>
<p>
The gem will detect a Camping app but you need to manually add the
instrumentation to your configuration file. See <a
href="../classes/RPMContrib/Instrumentation/Camping.html">RPMContrib::Instrumentation::Camping</a>
for more information.
</p>
<h3>Paperclip</h3>
<p>
No special configuration required for Paperclip visibility. You can disable
it by setting <tt>disable_paperclip</tt> to true in the newrelic.yml file.
</p>
<h3>Authlogic</h3>
<p>
No special configuration required for Authlogic visibility. You can disable
it by setting <tt>disable_authlogic</tt> to true in the newrelic.yml file.
</p>
<h3>MongoDB</h3>
<p>
No special configuration required for MongoDB visibility. You can disable
it by setting <tt>disable_mongodb</tt> to true in the newrelic.yml file.
</p>
<h3>Resque</h3>
<p>
To disable resque, add this to your newrelic.yml:
</p>
<pre>
    disable_resque: true
</pre>
<h1>How to Add Custom Instrumentation</h1>
<p>
We encourage contributions to this project and will provide whatever
assistance we can to those wishing to develop instrumentation for other
open source Ruby libraries.
</p>
<p>
When adding instrumentation to this gem, be sure and get familiar with the
RPM <a
href="http://newrelic.github.com/rpm/classes/NewRelic/Agent.html">Agent&nbsp;API</a>
and contact support@newrelic.com with any questions.
</p>
<p>
There are several extension points in the agent you can take advantage of
with this gem.
</p>
<ul>
<li>Custom tracers which measure methods and give visibility to otherwise
unmeasured libraries.

</li>
<li>Samplers which sample some value about once a minute.

</li>
<li>Dispatcher support for web request handlers which would otherwise be
undetected. In order for the agent to turn on in &#8216;auto&#8217; mode it
needs to discover a web dispatcher, or be <a
href="http://support.newrelic.com/faqs/general/manual-start">started&nbsp;manually</a>.

</li>
<li>Framework support, for alternatives to Rails like Camping or Ramaze

</li>
</ul>
<h2>Custom Tracers</h2>
<p>
Custom tracers for frameworks should be added to the
<tt>lib/rpm_contrib/instrumentation</tt> directory. These files are loaded
at the time the Agent starts. <b>They will not be loaded if the Agent does
not start up.</b>
</p>
<p>
It is important that you wrap any instrumentation with the checks necessary
to determine if the code being instrumented is loaded. You can&#8217;t add
code to the contrib gem that will break when run in any other context
besides yours.
</p>
<p>
For details on how to define custom tracers, refer to the support
documentation on adding <a
href="http://support.newrelic.com/faqs/docs/custom-metric-collection">custom&nbsp;tracers</a>.
You can also get detailed information on the API from the Agent method
tracing <a
href="http://newrelic.github.com/rpm/classes/NewRelic/Agent/MethodTracer.html">rdocs</a>,
especially the <a
href="http://newrelic.github.com/rpm/classes/NewRelic/Agent/MethodTracer/ClassMethods.html">add_method_tracer</a>
docs.
</p>
<p>
A good example can be found in <tt><a
href="lib/rpm_contrib/instrumentation/paperclip_rb.html">lib/rpm_contrib/instrumentation/paperclip.rb</a></tt>.
</p>
<h2>Samplers</h2>
<p>
You can add samplers which will record metrics approximately once a minute.
Samplers are useful for capturing generic instrumentation for display in <a
href="http://support.newrelic.com/faqs/docs/custom-dashboard-specification">custom&nbsp;views</a>.
</p>
<p>
Samplers should extend the <a
href="http://newrelic.github.com/rpm/classes/NewRelic/Agent/Sampler.html">NewRelic::Agent::Sampler</a>
class. They should be placed in the <tt>samplers</tt> directory.
</p>
<p>
Refer to examples in the RPM agent to see how to get started.
</p>
<h2>Supporting New Dispatchers</h2>
<p>
If you want to add support for a new dispatcher which is not being
recognized by default by the RPM agent, add code to the
<tt>rpm_contrib/detection</tt> directory. This code needs to define a
module in <a
href="../classes/NewRelic/LocalEnvironment.html">NewRelic::LocalEnvironment</a>.
This module will be accessed at the time environment detection takes place,
when the agent is initialized.
</p>
<p>
This module should define the method <tt>discover_dispatcher</tt> and
return the name of the dispatcher if detected, or defer to super. See
<tt>rpm_contrib/detection/camping.rb</tt> for a good example.
</p>
<h2>Supporting New Frameworks</h2>
<p>
Supporting new frameworks can be pretty involved and generally involves
both adding custom instrumentation as well as framework and dispatcher
detection.
</p>
<p>
In addition it will be necessary to define a new control class with the
same name as the framework. This control class must go in
<tt>new_relic/control</tt>.
</p>
<p>
Refer to the camping example in this gem to see how this is done in
general.
</p>
<p>
If you decide to tackle any new frameworks, contact support@newrelic.com
and we&#8217;ll be happy to help you work through it.
</p>
<h1>Note on Patches/Pull Requests</h1>
<ul>
<li>Fork the <a
href="http://www.github.com/newrelic/rpm_contrib">www.github.com/newrelic/rpm_contrib</a>
project.

</li>
<li>Add instrumentation files to <tt>lib/rpm_contrib/instrumentation</tt>.
These files will be loaded when the RPM agent is initialized.

</li>
<li>Add samplers to <tt>lib/rpm_contrib/samplers</tt>. These classes are
installed automatically when the RPM agent is initialized.

</li>
<li>Add tests.

</li>
<li>Commit, do not mess with the Rakefile, version, or history. (if you want to
have your own version, that is fine but bump version in a commit by itself
I can ignore when I pull)

</li>
<li>Send me a pull request. Bonus points for topic branches.

</li>
</ul>
<h1>Further Information</h1>
<p>
Refer to the Agent API Documentation at <a
href="http://newrelic.github.com/rpm">newrelic.github.com/rpm</a>
</p>
<p>
See the support site faqs at <a
href="http://support.newrelic.com/faqs">support.newrelic.com/faqs</a> for
additional tips and documentation.
</p>
<p>
Contact support@newrelic.com for help.
</p>
<h3>Copyright</h3>
<p>
Copyright &#169; 2009-2010 New Relic. See <a
href="LICENSE.html">LICENSE</a> for details.
</p>

    </div>
    

    

    
    

    
    

    

    

    

    

    

    
</div>
    </div>
  </body>
</html>